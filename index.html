<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CODEX CORE SYSTEM</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --neon-blue: #00d9ff; --gold: #f1c40f; --dark: #050505; }
        body { background: #000; color: #fff; font-family: 'Courier New', monospace; margin: 0; overflow: hidden; }
        
        /* L'IA CODEX - TA PHOTO */
        .header { background: #0a0a0a; padding: 15px; display: flex; align-items: center; border-bottom: 3px solid var(--neon-blue); box-shadow: 0 0 20px rgba(0,217,255,0.2); }
        .avatar-frame { width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--neon-blue); overflow: hidden; margin-right: 15px; background: #111; }
        .avatar-frame img { width: 100%; height: 100%; object-fit: cover; }

        /* CARTE SATELLITE CODEX */
        #map { width: 100%; height: 45vh; background: #000; }
        .leaflet-tile-pane { filter: brightness(0.4) invert(1) contrast(3) hue-rotate(180deg); }

        /* DASHBOARD DE GESTION */
        .dashboard { padding: 20px; background: #000; height: 55vh; display: flex; flex-direction: column; gap: 12px; }
        .capital-card { background: var(--dark); border: 1px solid #222; padding: 15px; text-align: center; border-radius: 4px; border-left: 4px solid var(--gold); }
        .money { font-size: 2.5rem; color: var(--gold); font-weight: bold; }
        
        .btn-buy { width: 100%; padding: 20px; border: none; background: var(--neon-blue); color: #000; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 1.1rem; border-radius: 4px; transition: 0.2s; }
        .btn-buy:active { transform: scale(0.98); background: #fff; }

        #console { background: #020202; border: 1px solid #111; padding: 10px; font-size: 0.75rem; color: #00ff00; height: 100px; overflow-y: auto; border-radius: 4px; }
    </style>
</head>
<body>

<div class="header">
    <div class="avatar-frame">
        <img src="https://i.ibb.co/Lzf7P8Q/avatar-ai.jpg" alt="IA">
    </div>
    <div>
        <div style="color: var(--neon-blue); font-weight: bold; letter-spacing: 1px;">CODEX OPERATIVE</div>
        <div id="status" style="font-size: 0.6rem; color: #888;">LIAISON SATELLITE...</div>
    </div>
</div>

<div id="map"></div>

<div class="dashboard">
    <div class="capital-card">
        <div style="font-size: 0.7rem; color: #666; margin-bottom: 5px;">CAPITAL DISPONIBLE</div>
        <div id="cash" class="money">10 000 Ø</div>
        <div id="income" style="font-size: 0.7rem; color: #2ecc71; margin-top: 5px;">REVENU PASSIF: 0 Ø/sec</div>
    </div>

    <div id="console">> SYSTÈME CODEX INITIALISÉ.<br>> SCAN DES SECTEURS EN COURS...</div>

    <button class="btn-buy" onclick="acquireZone()">ACQUÉRIR CE SECTEUR</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    let cash = 10000;
    let income = 0;
    
    // Initialisation Map
    var map = L.map('map', {zoomControl: false}).setView([45.858, 1.305], 16);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    function log(m) {
        const c = document.getElementById('console');
        c.innerHTML = "> " + m + "<br>" + c.innerHTML;
        c.scrollTop = 0;
    }

    // GÉOLOCALISATION
    function startGPS() {
        log("Tentative de verrouillage satellite...");
        map.locate({setView: true, maxZoom: 17});
    }

    map.on('locationfound', function(e) {
        log("Localisation réussie : Le Palais-sur-Vienne.");
        document.getElementById('status').innerText = "RADAR ACTIF - SECTEUR VERROUILLÉ";
        L.circle(e.latlng, {radius: 25, color: '#00d9ff', fillOpacity: 0.4}).addTo(map);
    });

    // MÉCANIQUE D'ACHAT
    function acquireZone() {
        if(cash >= 5000) {
            cash -= 5000;
            income += 200; // Chaque bâtiment rapporte 200 par cycle
            let currentPos = map.getCenter();
            
            // Marqueur Entreprise Codex
            L.circleMarker(currentPos, {
                radius: 12,
                color: '#00d9ff',
                fillOpacity: 1,
                weight: 3
            }).addTo(map).bindPopup("<b>ENTREPRISE CODEX</b><br>Génère 200Ø / 5s").openPopup();
            
            updateUI();
            log("Acquisition confirmée. Revenu passif mis à jour.");
        } else {
            log("ERREUR : Fonds insuffisants pour cet achat.");
        }
    }

    // BOUCLE DE REVENU (Toutes les 5 secondes)
    setInterval(() => {
        if(income > 0) {
            cash += income;
            updateUI();
            log("Réception revenus : +" + income + " Ø");
        }
    }, 5000);

    function updateUI() {
        document.getElementById('cash').innerText = cash.toLocaleString() + " Ø";
        document.getElementById('income').innerText = "REVENU PASSIF: " + income + " Ø/5sec";
    }

    // Lancer le GPS dès l'ouverture
    setTimeout(startGPS, 1000);
</script>
</body>
</html>
